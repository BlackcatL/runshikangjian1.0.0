var app = angular.module("newsword",[]);

app.directive("navWord",function() {
	return {
		restrict:"EACM",
		transclude:true,
		templateUrl:"../html/nav.html"
	}
}),

app.directive("footerWord",function() {
	return {
		restrict:"EACM",
		transclude:true,
		templateUrl:"../html/footer.html"
	}
}),

app.directive("newsBolg",function() {
	return {
		restrict:"EACM",
		transclude:true,
		templateUrl:"../html/news-blog.html"
	}
}),


/* --------------------- 获取后台数据 --------------------- */
//得到后台数据 ------>> service服务    $http 最常见的一种服务
app.controller('newsBolg2',function ($scope,$http) {
	$http({
		method:'GET',
		url:'../php/mysqlmin.php',
	}).then(function (response) {
		//成功后的回调函数
		$scope.products = response.data;

		/* --------------- 点击菜单，显示项目 --------------- */
		$scope.getProducts = function (myCategory) {
			//记录点击分类
			$scope.choosedCategory = myCategory;
			//接收返回数据
			var categoryProductsArr = [];
			if (myCategory == '全部') {
				categoryProductsArr = $scope.products;
			}else{
				for (var i = 0; i < $scope.products.length; i++) {
					if ($scope.products[i].category == myCategory) {
						categoryProductsArr.push($scope.products[i]);
					}
				}
			}
			$scope.categoryProducts = categoryProductsArr;
			$scope.getPages();
		}
		//自动调用一遍
		$scope.getProducts('全部');

		//点击左侧按钮调用相应样式
		$scope.addClass = function (myCategory) {
			return $scope.choosedCategory == myCategory ? 'btn-primary' : ''
		}
		/* ------------------------------------------------ */

		/* --------------------- 分页 --------------------- */
		$scope.getPages = function () {
			//存储页数
			var pages = [];
			var count = $scope.categoryProducts.length / 3;
			for (var i = 0; i < count; i++) {
				pages.push(i + 1);
			};
			$scope.myPages = pages;
		}
		/* ------------------------------------------------ */
	},function (error) {
		//失败后的回调函数
	})
});
/* -------------------------------------------------------- */

/* ----------------------- 过滤菜单 ----------------------- */
//过滤器filter  新模块
var myFilter = angular.module("filters",[]);
//自定义过滤器  filter('名称'，函数)
myFilter.filter("unique",function () {
//两个参数：要过滤的数据 过滤条件
	return function (products,property) {
		//判断过滤是否是数组 isArray()
		if (angular.isArray(products)) {
			var typeNames = [];
			var obj = {};
			for (var i = 0; i < products.length; i++){
				var type = products[i][property];
				if (angular.isUndefined(obj[type])){
					//将category push进去
					typeNames.push(type);
					obj[type] = true;
				}
			}	
			return typeNames;
		} else{
			return [];	
		}
	}
})

/* -------------------------------------------------------- */