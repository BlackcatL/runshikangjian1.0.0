var app = angular.module("indexword",[]);
app.directive("navWord",function() {
	return {
		restrict:"EACM",
		transclude:true,
		templateUrl:"../html/nav.html"
	}
}),
app.directive("footerWord",function() {
	return {
		restrict:"EACM",
		transclude:true,
		templateUrl:"../html/footer.html"
	}
}),
// app.directive("newsWord",function() {
// 	return {
// 		restrict:"EACM",
// 		transclude:true,
// 		templateUrl:"../html/index-news.html"
// 	}
// }),

/* --------------------- 获取后台数据 --------------------- */
//得到后台数据 ------>> service服务    $http 最常见的一种服务
app.controller('newsWord',function ($scope,$http) {
	return {
		restrict:"EACM",
		transclude:true,
		templateUrl:"../html/index-news.html"
	}
	$http({
		method:'GET',
		url:'../php/mysqlmin.php',
	}).then(function (response) {
		//成功后的回调函数
		$scope.journalism = response.data;

		/* --------------- 点击菜单，显示项目 --------------- */
		$scope.getProducts = function (myCategory) {
			//记录点击分类
			$scope.choosedCategory = myCategory;
			//接收返回数据
			var categoryProductsArr = [];
			if (myCategory == '全部') {
				categoryProductsArr = $scope.journalism;
			}else{
				for (var i = 0; i < $scope.journalism.length; i++) {
					if ($scope.journalism[i].category == myCategory) {
						categoryProductsArr.push($scope.journalism[i]);
					}
				}
			}
			$scope.categoryProducts = categoryProductsArr;
			$scope.getPages();
		}
		//自动调用一遍
		$scope.getProducts('新闻推送');
		/* ------------------------------------------------ */
	},function (error) {
		//失败后的回调函数
	})
});
/* -------------------------------------------------------- */

/* ----------------------- 过滤菜单 ----------------------- */
//过滤器filter  新模块
var myFilter = angular.module("filters",[]);
//自定义过滤器  filter('名称'，函数)
myFilter.filter("unique",function () {
//两个参数：要过滤的数据 过滤条件
	return function (journalism,property) {
		//判断过滤是否是数组 isArray()
		if (angular.isArray(journalism)) {
			var typeNames = [];
			var obj = {};
			for (var i = 0; i < journalism.length; i++){
				var type = journalism[i][property];
				if (angular.isUndefined(obj[type])){
					//将category push进去
					typeNames.push(type);
					obj[type] = true;
				}
			}	
			return typeNames;
		} else{
			return [];	
		}
	}
})

/* -------------------------------------------------------- */